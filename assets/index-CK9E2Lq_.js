var O=Object.defineProperty;var k=(n,e,t)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>k(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(c){if(c.ep)return;c.ep=!0;const a=t(c);fetch(c.href,a)}})();class w{constructor(e,t){u(this,"x");u(this,"y");this.x=e,this.y=t}isNeighbor(e){return e.x==this.x&&Math.abs(e.y-this.y)==1||e.y==this.y&&Math.abs(e.x-this.x)==1}isEqual(e){return this.x===e.x&&this.y===e.y}update(e){this.x=e.x,this.y=e.y}}class D{constructor(e,t){u(this,"position");u(this,"color");u(this,"element",null);this.position=new w(e.x,e.y),this.color=t}bindElement(e){this.element=e}select(){var e;(e=this.element)==null||e.select()}unselect(){var e;(e=this.element)==null||e.unselect()}disable(){var e;(e=this.element)==null||e.disable()}}class R{constructor(e,t){u(this,"_width");u(this,"_height");u(this,"id");u(this,"uniqueColors");u(this,"field");u(this,"selectedThing",null);u(this,"connectedThings",0);this.id=e;const s=[...t];s.sort((d,o)=>o.x-d.x);const c=s[0].x;s.sort((d,o)=>o.y-d.y);const a=s[0].y;this._width=c+1,this._height=a+1,this.field=Array.from({length:this._height},()=>Array.from({length:this._width},()=>null)),this.uniqueColors=new Set,t.forEach(d=>{const{x:o,y:r,color:l}=d;this.field[r][o]=new D(new w(o,r),l),this.uniqueColors.add(l)})}get width(){return this._width}get height(){return this._height}canConnect(e,t){return new Promise((s,c)=>{e.color!==t.color&&c(!1);const{x:a,y:d}=e.position,o=[{x:a,y:d}],r=[];for(;o.length;){const{x:l,y:i}=o.pop();r.some(h=>h.x===l&&h.y===i)||(t.position.isNeighbor(new w(l,i))&&s(!0),l-1>=0&&!this.field[i][l-1]&&o.push({x:l-1,y:i}),l+1<this._width&&!this.field[i][l+1]&&o.push({x:l+1,y:i}),i-1>=0&&!this.field[i-1][l]&&o.push({x:l,y:i-1}),i+1<this._height&&!this.field[i+1][l]&&o.push({x:l,y:i+1}),r.push({x:l,y:i}))}c(!1)})}countThings(){let e=0;for(let t=0;t<this._height;t++)for(let s=0;s<this._width;s++)this.field[t][s]&&(e+=1);return e}async tryToSelect(e,t){const s=this.field[t][e];if(!s)return"nothing";if(!this.selectedThing)return s.select(),this.selectedThing=s,"selected";if(this.selectedThing.position.x===e&&this.selectedThing.position.y===t)return this.selectedThing.unselect(),this.selectedThing=null,"unselected";try{return await this.canConnect(this.selectedThing,s),this.selectedThing.unselect(),this.selectedThing.disable(),this.field[this.selectedThing.position.y][this.selectedThing.position.x]=null,this.field[s.position.y][s.position.x]=null,this.selectedThing=null,s.disable(),this.connectedThings+=2,this.countThings()?"connected":"win"}catch{return this.selectedThing.unselect(),this.selectedThing=null,"notConnected"}}reset(){for(let e=0;e<this._height;e++)for(let t=0;t<this._width;t++);}}const S=[[{x:4,y:4,color:"#FFFF00"},{x:4,y:6,color:"#FFFF00"},{x:2,y:2,color:"#FF0000"},{x:3,y:2,color:"#00FF00"},{x:2,y:3,color:"#00FF00"},{x:3,y:3,color:"#0000FF"},{x:6,y:3,color:"#FFFF00"},{x:2,y:4,color:"#FF00FF"},{x:3,y:4,color:"#00FFFF"},{x:5,y:4,color:"#00FFFF"},{x:6,y:4,color:"#800080"},{x:3,y:5,color:"#FFFF00"},{x:4,y:5,color:"#FFA500"},{x:5,y:5,color:"#800080"},{x:6,y:5,color:"#FF0000"},{x:3,y:6,color:"#0000FF"},{x:5,y:6,color:"#FFA500"},{x:6,y:6,color:"#FF00FF"}],[{x:0,y:0,color:"#FF0000"},{x:10,y:14,color:"#FF0000"},{x:18,y:19,color:"#00FF00"},{x:19,y:18,color:"#00FF00"},{x:15,y:10,color:"#0000FF"},{x:15,y:11,color:"#0000FF"},{x:10,y:13,color:"#FFFF00"},{x:10,y:11,color:"#FFFF00"},{x:7,y:1,color:"#FF00FF"},{x:8,y:19,color:"#FF00FF"},{x:2,y:9,color:"#800080"},{x:5,y:2,color:"#800080"},{x:5,y:14,color:"#00FFFF"},{x:4,y:18,color:"#00FFFF"},{x:11,y:9,color:"#FF0000"},{x:11,y:2,color:"#00FF00"},{x:16,y:16,color:"#0000FF"},{x:18,y:18,color:"#FFFF00"},{x:13,y:13,color:"#FF00FF"},{x:15,y:15,color:"#00FFFF"},{x:17,y:2,color:"#800080"},{x:17,y:19,color:"#FFA500"},{x:18,y:3,color:"#FF0000"},{x:16,y:10,color:"#00FF00"},{x:19,y:1,color:"#0000FF"},{x:3,y:12,color:"#FFFF00"},{x:2,y:3,color:"#FF00FF"},{x:7,y:7,color:"#00FFFF"},{x:6,y:16,color:"#800080"},{x:6,y:1,color:"#FFA500"}]];class V{constructor(){u(this,"levels",{})}importLevels(){S.forEach((e,t)=>{this.createLevel(t,e)})}createLevel(e,t){this.levels[e]=new R(e,t)}resetLevel(e){const t=S[e];t&&this.createLevel(e,t)}}const x=new V;var G="clfprl0",K="yfu9qt0",Z="di7b3j0",z="di7b3j1",J="di7b3j2",Q="di7b3j3",W="di7b3j4",X="di7b3j5";const N=()=>{const n=document.createElement("div");return n.className=Z,n},C=(n,e)=>{const t=document.createElement("button");return t.className=J,t.textContent=n,t.onclick=e,t},M=n=>{const e=document.createElement("h1");return e.className=z,e.textContent=n,e},Y=()=>{const n=document.createElement("div");return n.className=Q,n},U=()=>{const n=document.createElement("div");return n.className=W,n},_=n=>{const e=document.createElement("p");return e.className=X,e.textContent=n,e};var ee="u5papc0",te="u5papc1",ne="u5papc2",oe="u5papc3",se="u5papc4",q="u5papc5",P="u5papc6",le="u5papc7";const ce=()=>{const n=document.createElement("div");return n.className=te,n},ie=()=>{const n=document.createElement("div");return n.className=ne,n},re=(n,e)=>{const t=document.createElement("div");return t.style.setProperty("--columns",n.toString()),t.style.setProperty("--rows",e.toString()),t.className=le,t},I=(n,e)=>{const t=document.createElement("div");return t.className=oe,t.onclick=n,e?(t.style.setProperty("--bg-color",e),t.classList.add(se)):t.classList.add(q),{element:t,select:()=>{t.classList.add(P)},unselect:()=>{t.classList.remove(P)},disable:()=>{t.classList.add(q)}}},L=n=>{const e=document.createElement("p");return e.className=ee,e.textContent=n,e};function j(n){return n<10?"0"+n:n.toString()}const A=new CustomEvent("gotomenu"),ae=new CustomEvent("levelSelection");var g;(n=>{const e=document.getElementById("app"),t=[];document.body.classList.add(K),e.className=G;function s(){d();const o=N(),r=M('Игра "Соедини 2 кубика"'),l=C("Выбрать уровень",()=>{document.dispatchEvent(ae)});o.appendChild(r),o.appendChild(l),e.appendChild(o)}n.drawMenu=s;function c(o){d();const r=N(),l=M("Выбери уровень"),i=Y(),f=C("Назад",()=>{document.dispatchEvent(A)});o.forEach(h=>{const m=U();m.appendChild(_(`${h.width} x ${h.height}`)),m.appendChild(_(`${[...h.uniqueColors].length} цветов`));const p=()=>{const E=new CustomEvent("playLevel",{detail:{id:h.id}});document.dispatchEvent(E)};m.addEventListener("click",p),t.push(()=>{m.removeEventListener("click",p)}),i.appendChild(m)}),r.appendChild(l),r.appendChild(i),r.appendChild(f),e.appendChild(r)}n.drawLevelSelection=c;function a(o){d();const r=ce(),l=ie(),i=L("Счёт: 0"),f=L(`Уровень ${o.id+1}`),h=L("00:00");let m=0;l.appendChild(i),l.appendChild(f),l.appendChild(h),r.appendChild(l);const p=re(o.width,o.height),E=setInterval(()=>{m+=1;const F=j(Math.floor(m/60)),y=j(m%60);h.textContent=`${F}:${y}`},1e3);for(let F=o.field.length-1;F>=0;F--)for(let y=0;y<o.field[F].length;y++){const v=o.field[F][y],T=v?I(()=>{o.tryToSelect(y,F).then(B=>{switch(B){case"connected":{i.textContent=`Счёт: ${Math.floor(o.connectedThings/2)}`;break}case"notConnected":{alert("Нельзя соединить эти кубики!");break}case"win":{i.textContent=`Счёт: ${Math.floor(o.connectedThings/2)}`,clearInterval(E),alert("Победа!");const H=new CustomEvent("playLevel",{detail:{id:o.id+1}}),b=C("Следующий уровень",()=>{document.dispatchEvent(H)}),$=C("В меню",()=>{document.dispatchEvent(A)});b.style.marginTop="20px",r.appendChild(b),r.appendChild($);break}}})},v.color):I(()=>{});v&&v.bindElement(T),p.appendChild(T.element)}r.appendChild(p),e.appendChild(r)}n.drawLevel=a;function d(){for(e.replaceChildren();t.length;)t.pop()()}n.clearInterface=d})(g||(g={}));class de{constructor(){u(this,"leaderboard",[]);document.addEventListener("gotomenu",()=>{this.setMenuStage()}),document.addEventListener("levelSelection",()=>{this.setLevelSelectionStage()}),document.addEventListener("playLevel",e=>{const s=e.detail.id;this.setPlayingStage(s)})}setMenuStage(){g.drawMenu()}setLevelSelectionStage(){g.drawLevelSelection(Object.values(x.levels))}setPlayingStage(e){x.levels[e]?(x.resetLevel(e),g.drawLevel(x.levels[e])):this.setLevelSelectionStage()}}const ue=new de;x.importLevels();ue.setMenuStage();
